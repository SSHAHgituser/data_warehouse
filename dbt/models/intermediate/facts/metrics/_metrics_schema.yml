version: 2

models:
  # ============================================
  # METRICS BUILDING BLOCKS
  # ============================================
  # These models extract metrics from fact tables in a lean format.
  # Each model only includes columns relevant to its metrics.
  # fact_global_metrics handles column alignment and 'All' defaults.
  
  - name: metrics_sales_order
    description: |
      Sales order metrics extracted from fact_sales_order.
      Granularity: One row per metric per sales order.
      
      Metrics: SO_REVENUE, SO_SUBTOTAL, SO_TAX, SO_FREIGHT, SO_QUANTITY, 
               SO_LINE_ITEMS, SO_DISCOUNT, SO_DAYS_TO_SHIP
    columns:
      - name: date_key
        description: "Order date key (YYYYMMDD format)"
      - name: customer_key
        description: "Foreign key to dim_customer"
      - name: employee_key
        description: "Foreign key to dim_employee"
      - name: territory_key
        description: "Foreign key to dim_territory"
      - name: ship_method_key
        description: "Foreign key to ship method"
      - name: credit_card_key
        description: "Foreign key to credit card"
      - name: online_order_flag
        description: "'Online' or 'In-Store'"
      - name: order_status
        description: "Order status code"

  - name: metrics_sales_line
    description: |
      Sales line item metrics extracted from fact_sales_order_line.
      Granularity: One row per metric per line item.
      
      Metrics: SOL_REVENUE, SOL_GROSS_AMOUNT, SOL_QUANTITY, SOL_PROFIT,
               SOL_PROFIT_MARGIN, SOL_DISCOUNT, SOL_UNIT_PRICE
    columns:
      - name: date_key
        description: "Order date key (YYYYMMDD format)"
      - name: customer_key
        description: "Foreign key to dim_customer"
      - name: product_key
        description: "Foreign key to dim_product"
      - name: employee_key
        description: "Foreign key to dim_employee"
      - name: territory_key
        description: "Foreign key to dim_territory"
      - name: special_offer_key
        description: "Foreign key to special offer"
      - name: parent_order_id
        description: "Reference to parent sales order"
      - name: has_discount
        description: "'Yes' or 'No'"

  - name: metrics_inventory
    description: |
      Inventory metrics extracted from fact_inventory.
      Granularity: One row per metric per product/location.
      
      Metrics: INV_QUANTITY, INV_VALUE, INV_ABOVE_SAFETY, INV_REORDER_PCT
    columns:
      - name: date_key
        description: "Report date key (snapshot date)"
      - name: product_key
        description: "Foreign key to dim_product"
      - name: location_key
        description: "Location identifier"
      - name: inventory_status
        description: "'In Stock', 'Out of Stock', 'Below Safety Stock', 'At Reorder Point'"
      - name: location_name
        description: "Name of the inventory location"
      - name: safety_stock_level
        description: "Safety stock level threshold"
      - name: reorder_point
        description: "Reorder point threshold"

  - name: metrics_purchase_order
    description: |
      Purchase order metrics extracted from fact_purchase_order.
      Granularity: One row per metric per purchase order.
      
      Metrics: PO_AMOUNT, PO_SUBTOTAL, PO_TAX, PO_FREIGHT, PO_QUANTITY,
               PO_RECEIVED_QTY, PO_REJECTED_QTY, PO_REJECTION_RATE,
               PO_FULFILLMENT_RATE, PO_DAYS_TO_SHIP
    columns:
      - name: date_key
        description: "Order date key (YYYYMMDD format)"
      - name: vendor_key
        description: "Foreign key to dim_vendor"
      - name: employee_key
        description: "Foreign key to dim_employee"
      - name: ship_method_key
        description: "Foreign key to ship method"
      - name: order_status
        description: "Purchase order status code"

  - name: metrics_work_order
    description: |
      Work order metrics extracted from fact_work_order.
      Granularity: One row per metric per work order.
      
      Metrics: WO_ORDER_QTY, WO_GOOD_QTY, WO_SCRAPPED_QTY, WO_SCRAP_RATE,
               WO_PLANNED_COST, WO_ACTUAL_COST, WO_COST_VARIANCE,
               WO_COST_VARIANCE_PCT, WO_PRODUCTION_DAYS, WO_ACTUAL_HOURS,
               WO_HOURS_PER_UNIT
    columns:
      - name: date_key
        description: "Start date key (YYYYMMDD format)"
      - name: product_key
        description: "Foreign key to dim_product"
      - name: scrap_reason_key
        description: "Foreign key to scrap reason"
      - name: delivery_status
        description: "'On Time', 'Slightly Late', 'Late'"
      - name: scrap_reason_name
        description: "Scrap reason or 'None'"
      - name: number_of_operations
        description: "Number of routing operations"

  - name: metrics_employee_quota
    description: |
      Employee quota metrics extracted from fact_employee_quota.
      Granularity: One row per metric per employee/quota period.
      
      Metrics: EQ_QUOTA, EQ_SALES_YTD, EQ_SALES_LAST_YEAR,
               EQ_ACHIEVEMENT_PCT, EQ_QUOTA_VARIANCE, EQ_BONUS
    columns:
      - name: date_key
        description: "Quota date key (YYYYMMDD format)"
      - name: employee_key
        description: "Foreign key to dim_employee"
      - name: territory_key
        description: "Foreign key to dim_territory"
      - name: quota_status
        description: "'Achieved', 'Near Target', 'Below Target'"
      - name: commission_pct
        description: "Commission percentage for the employee"
