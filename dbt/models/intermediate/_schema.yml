version: 2

models:
  # ============================================
  # DIMENSION TABLES
  # ============================================
  
  - name: dim_customer
    description: "Customer dimension with demographics, sales history, and segmentation"
    columns:
      - name: customerid
        description: "Primary key"
      - name: lifetime_value
        description: "Total revenue from customer"
      - name: customer_segment
        description: "Value segment: High/Medium/Low Value"
      - name: customer_status
        description: "Activity status: Active/At Risk/Inactive"
      - name: purchase_frequency
        description: "Frequency: Frequent/Regular/Occasional"

  - name: dim_product
    description: "Product dimension with category hierarchy and performance"
    columns:
      - name: productid
        description: "Primary key"
      - name: product_name
        description: "Product name"
      - name: category_name
        description: "Product category"
      - name: total_revenue
        description: "Total sales revenue"
      - name: profit_margin_percent
        description: "Profit margin %"
      - name: product_status
        description: "Status: Active/Discontinued/Not Yet Available"

  - name: dim_date
    description: "Date dimension for time-based analysis"
    columns:
      - name: date_key
        description: "Primary key (YYYYMMDD)"
      - name: date_day
        description: "Date value"
      - name: year
        description: "Year"
      - name: quarter
        description: "Quarter (1-4)"
      - name: month
        description: "Month (1-12)"
      - name: season
        description: "Season: Winter/Spring/Summer/Fall"

  - name: dim_employee
    description: "Employee dimension with HR data and sales performance"
    columns:
      - name: employee_id
        description: "Primary key"
      - name: jobtitle
        description: "Job title"
      - name: department_name
        description: "Department"
      - name: sales_year_to_date
        description: "Sales YTD"
      - name: quota_achievement_percent
        description: "Quota achievement %"

  - name: dim_territory
    description: "Sales territory dimension with performance metrics"
    columns:
      - name: territoryid
        description: "Primary key"
      - name: territory_name
        description: "Territory name"
      - name: countryregioncode
        description: "Country/region code"
      - name: total_revenue
        description: "Total revenue"
      - name: performance_category
        description: "Performance: High/Medium/Low/No Sales"

  - name: dim_vendor
    description: "Vendor dimension with purchase history and performance"
    columns:
      - name: vendor_id
        description: "Primary key"
      - name: vendor_name
        description: "Vendor name"
      - name: total_purchase_amount
        description: "Total purchases"
      - name: avg_delivery_days
        description: "Avg delivery days"
      - name: vendor_status
        description: "Status: Active/Inactive"

  - name: dim_metric
    description: |
      Metrics catalog - single source of truth for all metric metadata.
      Supports hierarchical metrics tree from operational to strategic KPIs.
      
      Hierarchy Levels:
      - L1_Operational: Line-item, transactional metrics
      - L2_Process: Order-level, process aggregations
      - L3_Tactical: Department/function metrics
      - L4_Strategic: Business unit metrics
      - L5_KPI: Executive KPIs
    columns:
      - name: metric_id
        description: "Surrogate key"
      - name: metric_key
        description: "Unique identifier (e.g., SO_REVENUE)"
      - name: metric_name
        description: "Human-readable name"
      - name: metric_category
        description: "Category: Sales, Inventory, Procurement, Production, HR, Financial, Operations"
      - name: metric_unit
        description: "Unit: USD, Count, Percent, Days, Hours"
      - name: metric_level
        description: "Hierarchy level: L1-L5"
      - name: metric_parent
        description: "Parent metric_key (null for top-level)"
      - name: metric_children
        description: "Child metric_keys (comma-separated)"
      - name: metric_description
        description: "Business definition"
      - name: metric_target
        description: "Target/goal"
      - name: alert_criteria
        description: "Alert conditions"
      - name: recommended_actions
        description: "Suggested follow-up actions"
      - name: reference_metrics
        description: "Related metrics for impact analysis"
      - name: owner_name
        description: "Metric owner name"
      - name: owner_email
        description: "Metric owner email"
      - name: created_at
        description: "Record created timestamp"
      - name: updated_at
        description: "Record updated timestamp"

  # ============================================
  # FACT TABLES
  # ============================================
  
  - name: fact_sales_order
    description: "Sales order fact - one row per order"
    columns:
      - name: salesorderid
        description: "Primary key"
      - name: order_date_key
        description: "FK to dim_date"
      - name: customer_key
        description: "FK to dim_customer"
      - name: employee_key
        description: "FK to dim_employee"
      - name: territory_key
        description: "FK to dim_territory"
      - name: totaldue
        description: "Total amount due"
      - name: days_to_ship
        description: "Days from order to ship"

  - name: fact_sales_order_line
    description: "Sales order line fact - one row per line item"
    columns:
      - name: salesorderid
        description: "FK to sales order"
      - name: salesorderdetailid
        description: "Primary key"
      - name: order_date_key
        description: "FK to dim_date"
      - name: product_key
        description: "FK to dim_product"
      - name: orderqty
        description: "Quantity ordered"
      - name: net_line_amount
        description: "Net amount after discounts"
      - name: total_profit
        description: "Line item profit"

  - name: fact_inventory
    description: "Inventory fact - one row per product/location"
    columns:
      - name: product_key
        description: "FK to dim_product"
      - name: location_key
        description: "Location identifier"
      - name: quantity
        description: "Current quantity"
      - name: inventory_value
        description: "Value (qty Ã— cost)"
      - name: inventory_status
        description: "Status: In Stock/Out of Stock/Below Safety/At Reorder"

  - name: fact_purchase_order
    description: "Purchase order fact - one row per PO"
    columns:
      - name: purchaseorderid
        description: "Primary key"
      - name: order_date_key
        description: "FK to dim_date"
      - name: vendor_key
        description: "FK to dim_vendor"
      - name: totaldue
        description: "Total PO amount"
      - name: rejection_rate_percent
        description: "Rejection rate %"

  - name: fact_work_order
    description: "Work order fact - one row per work order"
    columns:
      - name: workorderid
        description: "Primary key"
      - name: start_date_key
        description: "FK to dim_date"
      - name: product_key
        description: "FK to dim_product"
      - name: production_days
        description: "Days to complete"
      - name: cost_variance
        description: "Actual - planned cost"
      - name: scrap_rate_percent
        description: "Scrap rate %"

  - name: fact_employee_quota
    description: "Employee quota fact - one row per quota period"
    columns:
      - name: employee_key
        description: "FK to dim_employee"
      - name: quota_date_key
        description: "FK to dim_date"
      - name: salesquota
        description: "Quota amount"
      - name: quota_achievement_percent
        description: "Achievement %"
      - name: quota_status
        description: "Status: Achieved/Near Target/Below Target"

  # ============================================
  # GLOBAL METRICS FACT TABLE
  # ============================================
  
  - name: fact_global_metrics
    description: |
      Unified metrics fact table - "tall" format with one row per metric value.
      Consolidates metrics from all fact tables for cross-domain analytics.
      
      Contains metric_key (FK to dim_metric) - use mart_metrics for metric names/categories.
      Uses 'All' for dimension columns not applicable to a metric type.
    columns:
      # Primary key
      - name: metric_record_id
        description: "Surrogate key"
      # Date columns
      - name: date_key
        description: "Date key (YYYYMMDD) - FK to dim_date"
      - name: report_date
        description: "Snapshot date"
      # Metric key (FK only - join with dim_metric or use mart_metrics)
      - name: metric_key
        description: "Metric identifier - FK to dim_metric (use mart_metrics for names)"
      # Source info
      - name: source_table
        description: "Source fact table name"
      - name: source_record_id
        description: "Original record ID"
      # Core dimension keys (nullable)
      - name: customer_key
        description: "FK to dim_customer"
      - name: product_key
        description: "FK to dim_product"
      - name: employee_key
        description: "FK to dim_employee"
      - name: territory_key
        description: "FK to dim_territory"
      - name: vendor_key
        description: "FK to dim_vendor"
      - name: location_key
        description: "Location identifier"
      # Additional dimension keys (nullable)
      - name: ship_method_key
        description: "FK to ship method"
      - name: credit_card_key
        description: "FK to credit card"
      - name: special_offer_key
        description: "FK to special offer"
      - name: scrap_reason_key
        description: "FK to scrap reason"
      - name: parent_order_id
        description: "Parent order reference"
      # Status columns ('All' = not applicable)
      - name: online_order_flag
        description: "'Online', 'In-Store', or 'All'"
      - name: has_discount
        description: "'Yes', 'No', or 'All'"
      - name: inventory_status
        description: "Inventory status or 'All'"
      - name: order_status
        description: "Order status or 'All'"
      - name: delivery_status
        description: "'On Time', 'Late', or 'All'"
      - name: quota_status
        description: "'Achieved', 'Below Target', or 'All'"
      # Context columns
      - name: location_name
        description: "Location name or 'All'"
      - name: scrap_reason_name
        description: "Scrap reason, 'None', or 'All'"
      - name: safety_stock_level
        description: "Safety stock level (null if N/A)"
      - name: reorder_point
        description: "Reorder point (null if N/A)"
      - name: number_of_operations
        description: "Operation count (null if N/A)"
      - name: commission_pct
        description: "Commission % (null if N/A)"
      # Metric value
      - name: metric_value
        description: "The numeric metric value"
      - name: created_at
        description: "Record created timestamp"
