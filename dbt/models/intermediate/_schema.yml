version: 2

models:
  # Dimension Tables
  - name: dim_customer
    description: "Customer dimension table with demographics, sales history, and segmentation"
    columns:
      - name: customerid
        description: "Primary key - Customer identifier"
      - name: lifetime_value
        description: "Total revenue generated by customer"
      - name: customer_segment
        description: "Customer value segment (High/Medium/Low Value)"
      - name: customer_status
        description: "Customer activity status (Active/At Risk/Inactive)"
      - name: purchase_frequency
        description: "Purchase frequency category (Frequent/Regular/Occasional)"

  - name: dim_product
    description: "Product dimension with category hierarchy, pricing, and sales performance"
    columns:
      - name: productid
        description: "Primary key - Product identifier"
      - name: product_name
        description: "Product name"
      - name: category_name
        description: "Product category"
      - name: total_revenue
        description: "Total sales revenue for product"
      - name: profit_margin_percent
        description: "Profit margin percentage"
      - name: product_status
        description: "Product status (Active/Discontinued/Not Yet Available)"

  - name: dim_date
    description: "Date dimension table for time-based analysis"
    columns:
      - name: date_key
        description: "Primary key - Date in YYYYMMDD format"
      - name: date_day
        description: "Date value"
      - name: year
        description: "Year"
      - name: quarter
        description: "Quarter (1-4)"
      - name: month
        description: "Month (1-12)"
      - name: season
        description: "Season (Winter/Spring/Summer/Fall)"

  - name: dim_employee
    description: "Employee dimension with HR data and sales performance"
    columns:
      - name: employee_id
        description: "Primary key - Employee identifier"
      - name: jobtitle
        description: "Employee job title"
      - name: department_name
        description: "Current department"
      - name: sales_year_to_date
        description: "Sales year to date"
      - name: quota_achievement_percent
        description: "Percentage of sales quota achieved"

  - name: dim_territory
    description: "Sales territory dimension with performance metrics"
    columns:
      - name: territoryid
        description: "Primary key - Territory identifier"
      - name: territory_name
        description: "Territory name"
      - name: countryregioncode
        description: "Country region code"
      - name: total_revenue
        description: "Total revenue for territory"
      - name: performance_category
        description: "Performance category (High/Medium/Low/No Sales)"

  - name: dim_vendor
    description: "Vendor dimension with purchase history and performance"
    columns:
      - name: vendor_id
        description: "Primary key - Vendor identifier"
      - name: vendor_name
        description: "Vendor name"
      - name: total_purchase_amount
        description: "Total amount purchased from vendor"
      - name: avg_delivery_days
        description: "Average delivery days"
      - name: vendor_status
        description: "Vendor status (Active/Inactive)"

  - name: dim_metric
    description: |
      Metrics catalog dimension table documenting all metrics in fact_global_metrics.
      Provides business definitions, targets, alerts, and ownership information.
      
      Use cases:
      - Self-service analytics with clear metric definitions
      - Metrics governance and accountability
      - Automated alerting and monitoring
      - Impact analysis via reference_metrics
      - Data literacy and onboarding
    columns:
      - name: metric_id
        description: "Surrogate key for the metric"
      - name: metric_key
        description: "Unique metric identifier matching fact_global_metrics.metric_key"
      - name: metric_name
        description: "Human-readable metric name"
      - name: metric_category
        description: "Category: Sales, Inventory, Procurement, Production, HR"
      - name: metric_description
        description: "Detailed business definition and meaning of the metric"
      - name: metric_target
        description: "Target/goal for the metric (e.g., '>= 25%', 'YoY growth >= 10%')"
      - name: alert_criteria
        description: "Conditions that should trigger alerts (e.g., 'ALERT if: value < threshold')"
      - name: recommended_actions
        description: "Suggested follow-up actions based on metric values"
      - name: reference_metrics
        description: "Related metrics to track for impact analysis (comma-separated)"
      - name: owner_name
        description: "Name of the metric owner/steward"
      - name: owner_email
        description: "Email of the metric owner/steward"
      - name: created_at
        description: "Timestamp when the record was created"
      - name: updated_at
        description: "Timestamp when the record was last updated"

  # Fact Tables
  - name: fact_sales_order
    description: "Sales order fact table - one row per order"
    columns:
      - name: salesorderid
        description: "Primary key - Sales order identifier"
      - name: order_date_key
        description: "Foreign key to dim_date"
      - name: customer_key
        description: "Foreign key to dim_customer"
      - name: employee_key
        description: "Foreign key to dim_employee"
      - name: territory_key
        description: "Foreign key to dim_territory"
      - name: totaldue
        description: "Total order amount due"
      - name: days_to_ship
        description: "Days from order to ship date"

  - name: fact_sales_order_line
    description: "Sales order line item fact - one row per order line"
    columns:
      - name: salesorderid
        description: "Foreign key - Sales order identifier"
      - name: salesorderdetailid
        description: "Primary key - Order line identifier"
      - name: order_date_key
        description: "Foreign key to dim_date"
      - name: product_key
        description: "Foreign key to dim_product"
      - name: orderqty
        description: "Quantity ordered"
      - name: net_line_amount
        description: "Net line amount after discounts"
      - name: total_profit
        description: "Total profit for line item"

  - name: fact_inventory
    description: "Inventory fact table - one row per product/location"
    columns:
      - name: product_key
        description: "Foreign key to dim_product"
      - name: location_key
        description: "Location identifier"
      - name: quantity
        description: "Current inventory quantity"
      - name: inventory_value
        description: "Inventory value (quantity * cost)"
      - name: inventory_status
        description: "Inventory status (Out of Stock/Below Safety Stock/At Reorder Point/In Stock)"

  - name: fact_purchase_order
    description: "Purchase order fact table - one row per purchase order"
    columns:
      - name: purchaseorderid
        description: "Primary key - Purchase order identifier"
      - name: order_date_key
        description: "Foreign key to dim_date"
      - name: vendor_key
        description: "Foreign key to dim_vendor"
      - name: totaldue
        description: "Total purchase order amount"
      - name: rejection_rate_percent
        description: "Percentage of rejected items"

  - name: fact_work_order
    description: "Work order fact table - one row per work order"
    columns:
      - name: workorderid
        description: "Primary key - Work order identifier"
      - name: start_date_key
        description: "Foreign key to dim_date"
      - name: product_key
        description: "Foreign key to dim_product"
      - name: production_days
        description: "Days to complete production"
      - name: cost_variance
        description: "Difference between actual and planned cost"
      - name: scrap_rate_percent
        description: "Percentage of scrapped quantity"

  - name: fact_employee_quota
    description: "Employee quota fact table - one row per quota period"
    columns:
      - name: employee_key
        description: "Foreign key to dim_employee"
      - name: quota_date_key
        description: "Foreign key to dim_date"
      - name: salesquota
        description: "Sales quota amount"
      - name: quota_achievement_percent
        description: "Percentage of quota achieved"
      - name: quota_status
        description: "Quota status (Achieved/Near Target/Below Target)"

  - name: fact_global_metrics
    description: |
      Global metrics fact table consolidating all metrics from fact tables into a unified 'tall' format.
      Each row represents one metric value with its associated dimensions.
      
      Supports:
      - Cross-domain analytics and comparisons
      - Flexible time-series analysis
      - Consistent metric definitions
      - Dynamic dashboards and reporting
      
      Dimension columns use 'All' as default value when not applicable to a metric.
      This enables easy filtering without NULL handling.
      
      Source tables: fact_sales_order, fact_sales_order_line, fact_inventory, 
                     fact_purchase_order, fact_work_order, fact_employee_quota
    columns:
      - name: metric_record_id
        description: "Surrogate key - unique identifier for each metric record"
      - name: date_key
        description: "Date key in YYYYMMDD format - foreign key to dim_date"
      - name: report_date
        description: "Report date - the max transaction date across all data (snapshot date)"
      - name: metric_key
        description: "Unique metric identifier (e.g., SO_REVENUE, INV_QUANTITY, WO_SCRAP_RATE)"
      - name: metric_name
        description: "Human-readable metric name"
      - name: metric_category
        description: "Metric category: Sales, Inventory, Procurement, Production, HR"
      - name: source_table
        description: "Source fact table name"
      - name: source_record_id
        description: "Original record ID from source table"
      # Core dimension keys
      - name: customer_key
        description: "Foreign key to dim_customer (nullable)"
      - name: product_key
        description: "Foreign key to dim_product (nullable)"
      - name: employee_key
        description: "Foreign key to dim_employee (nullable)"
      - name: territory_key
        description: "Foreign key to dim_territory (nullable)"
      - name: vendor_key
        description: "Foreign key to dim_vendor (nullable)"
      - name: location_key
        description: "Foreign key to location (nullable)"
      # Additional dimension keys
      - name: ship_method_key
        description: "Foreign key to ship method (nullable)"
      - name: credit_card_key
        description: "Foreign key to credit card (nullable)"
      - name: special_offer_key
        description: "Foreign key to special offer (nullable)"
      - name: scrap_reason_key
        description: "Foreign key to scrap reason (nullable)"
      - name: parent_order_id
        description: "Reference to parent order ID (nullable)"
      # Status dimension columns (text, 'All' = not applicable)
      - name: online_order_flag
        description: "Order channel: 'Online', 'In-Store', or 'All' if not applicable"
      - name: has_discount
        description: "Discount applied: 'Yes', 'No', or 'All' if not applicable"
      - name: inventory_status
        description: "Inventory status: 'In Stock', 'Out of Stock', etc., or 'All'"
      - name: order_status
        description: "Order status code or 'All' if not applicable"
      - name: delivery_status
        description: "Delivery status: 'On Time', 'Late', etc., or 'All'"
      - name: quota_status
        description: "Quota status: 'Achieved', 'Near Target', etc., or 'All'"
      # Context columns
      - name: location_name
        description: "Location name or 'All' if not applicable"
      - name: scrap_reason_name
        description: "Scrap reason name, 'None', or 'All'"
      - name: safety_stock_level
        description: "Safety stock level (numeric, null if N/A)"
      - name: reorder_point
        description: "Reorder point (numeric, null if N/A)"
      - name: number_of_operations
        description: "Number of operations (numeric, null if N/A)"
      - name: commission_pct
        description: "Commission percentage (numeric, null if N/A)"
      # Metric value
      - name: metric_value
        description: "The numeric metric value"
      - name: metric_unit
        description: "Unit of measure: USD, Count, Percent, Days, Hours"
      - name: created_at
        description: "Timestamp when the record was created"
