{{ config(materialized='table') }}

{#
    Metrics Dimension Table
    =======================
    Documents all metrics in the global metrics table with:
    - Business definitions and meaning
    - Unit of measure (USD, Count, Percent, Days, Hours)
    - Hierarchy (level, parent, children) for metrics tree
    - Targets and goals
    - Alert criteria for monitoring
    - Recommended follow-up actions
    - Related metrics for impact tracking
    - Ownership information
    
    Metric Levels (from lowest to highest):
    - L1_Operational: Granular transactional metrics (line items, work orders)
    - L2_Process: Process-level aggregations (orders, inventory)
    - L3_Tactical: Department/function level metrics
    - L4_Strategic: Business unit / company-wide metrics
    - L5_KPI: Top-level industry KPIs and performance indicators
    
    This enables:
    - Metrics tree navigation from operational to KPIs
    - Drill-down analysis from KPIs to root causes
    - Self-service analytics with clear metric definitions
    - Automated alerting and monitoring
#}

with metrics_catalog as (
    select * from (
        values
        -- ============================================
        -- SALES ORDER METRICS (SO_*) - L2_Process
        -- ============================================
        (
            'SO_REVENUE',
            'Sales Order Revenue',
            'Sales',
            'USD',
            'L2_Process',
            'TOTAL_REVENUE',
            'SOL_REVENUE',
            'Total revenue from sales orders including tax and freight. Represents the final amount due from customers.',
            'YoY growth >= 10%',
            'ALERT if: MoM decline > 15% OR YoY decline > 10%',
            'If declining: Review pricing strategy, analyze customer segments, check for seasonal patterns.',
            'SO_QUANTITY, SOL_PROFIT, EQ_SALES_YTD',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SO_SUBTOTAL',
            'Sales Order Subtotal',
            'Sales',
            'USD',
            'L2_Process',
            'SO_REVENUE',
            null,
            'Order subtotal before tax and freight charges. Useful for analyzing base sales performance.',
            'Maintain 85-90% of SO_REVENUE',
            'ALERT if: Ratio to SO_REVENUE < 80%',
            'Compare with SO_REVENUE to understand tax/freight impact.',
            'SO_REVENUE, SO_TAX, SO_FREIGHT',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SO_TAX',
            'Sales Order Tax',
            'Sales',
            'USD',
            'L1_Operational',
            'SO_REVENUE',
            null,
            'Tax amount collected on sales orders. Varies by territory and product category.',
            'Maintain compliance (territory-specific)',
            'ALERT if: Tax rate variance > 2% from expected',
            'Ensure compliance with tax regulations.',
            'SO_REVENUE, SO_SUBTOTAL',
            'Michael Chen',
            'michael.chen@adventureworks.com'
        ),
        (
            'SO_FREIGHT',
            'Sales Order Freight',
            'Sales',
            'USD',
            'L1_Operational',
            'SO_REVENUE',
            null,
            'Shipping and freight charges for sales orders.',
            'Freight <= 5% of SO_SUBTOTAL',
            'ALERT if: Freight > 8% of subtotal',
            'If high: Negotiate carrier rates, optimize shipping routes.',
            'SO_REVENUE, SO_DAYS_TO_SHIP',
            'Michael Chen',
            'michael.chen@adventureworks.com'
        ),
        (
            'SO_QUANTITY',
            'Sales Order Quantity',
            'Sales',
            'Count',
            'L2_Process',
            'TOTAL_UNITS_SOLD',
            'SOL_QUANTITY',
            'Total quantity of items ordered. Indicates volume of business activity.',
            'YoY growth >= 5%',
            'ALERT if: Daily quantity < 50% of 30-day avg',
            'Track trends for demand forecasting.',
            'SO_REVENUE, INV_QUANTITY, SOL_QUANTITY',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SO_LINE_ITEMS',
            'Sales Order Line Items',
            'Sales',
            'Count',
            'L1_Operational',
            'SO_QUANTITY',
            null,
            'Number of distinct line items per order. Indicates cross-selling effectiveness.',
            'Avg >= 3 line items per order',
            'ALERT if: Avg line items per order < 2',
            'Low values may indicate cross-sell opportunities.',
            'SO_REVENUE, SOL_REVENUE',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SO_DISCOUNT',
            'Sales Order Discount',
            'Sales',
            'USD',
            'L2_Process',
            'GROSS_MARGIN',
            'SOL_DISCOUNT',
            'Total discount amount applied to orders.',
            'Discount <= 10% of gross revenue',
            'ALERT if: Discount rate > 15%',
            'Monitor discount trends for pricing issues.',
            'SO_REVENUE, SOL_PROFIT',
            'David Williams',
            'david.williams@adventureworks.com'
        ),
        (
            'SO_DAYS_TO_SHIP',
            'Days to Ship',
            'Sales',
            'Days',
            'L2_Process',
            'CUSTOMER_SATISFACTION',
            null,
            'Number of days from order placement to shipment.',
            'Avg <= 3 days',
            'ALERT if: Avg > 5 days OR any order > 10 days',
            'If increasing: Review warehouse operations.',
            'SO_FREIGHT, PO_DAYS_TO_SHIP',
            'Lisa Martinez',
            'lisa.martinez@adventureworks.com'
        ),
        
        -- ============================================
        -- SALES LINE ITEM METRICS (SOL_*) - L1_Operational
        -- ============================================
        (
            'SOL_REVENUE',
            'Line Item Revenue',
            'Sales',
            'USD',
            'L1_Operational',
            'SO_REVENUE',
            null,
            'Net revenue per line item after discounts.',
            'Positive growth by product category',
            'ALERT if: Top 10 products show > 20% decline MoM',
            'Identify top-selling products.',
            'SO_REVENUE, SOL_PROFIT, SOL_QUANTITY',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SOL_GROSS_AMOUNT',
            'Line Item Gross Amount',
            'Sales',
            'USD',
            'L1_Operational',
            'SOL_REVENUE',
            null,
            'Gross amount before discounts.',
            'Gross-to-net ratio >= 90%',
            'ALERT if: Gross-to-net ratio < 85%',
            'High variance indicates heavy discounting.',
            'SOL_REVENUE, SOL_DISCOUNT',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SOL_QUANTITY',
            'Line Item Quantity',
            'Sales',
            'Count',
            'L1_Operational',
            'SO_QUANTITY',
            null,
            'Quantity ordered per line item.',
            'Align with demand forecast ±10%',
            'ALERT if: Actual vs forecast variance > 25%',
            'Feed into demand forecasting models.',
            'SO_QUANTITY, INV_QUANTITY',
            'Sarah Johnson',
            'sarah.johnson@adventureworks.com'
        ),
        (
            'SOL_PROFIT',
            'Line Item Profit',
            'Sales',
            'USD',
            'L1_Operational',
            'GROSS_PROFIT',
            null,
            'Profit per line item (revenue minus cost).',
            'Positive profit on all line items',
            'ALERT if: Any product shows negative profit',
            'Negative profit requires immediate attention.',
            'SOL_REVENUE, SOL_PROFIT_MARGIN',
            'David Williams',
            'david.williams@adventureworks.com'
        ),
        (
            'SOL_PROFIT_MARGIN',
            'Line Item Profit Margin',
            'Sales',
            'Percent',
            'L1_Operational',
            'GROSS_MARGIN',
            null,
            'Profit margin percentage per line item.',
            '>= 25% overall, >= 15% minimum',
            'ALERT if: Margin < 15%',
            'Below 20%: Review costs or pricing.',
            'SOL_PROFIT, SOL_REVENUE',
            'David Williams',
            'david.williams@adventureworks.com'
        ),
        (
            'SOL_DISCOUNT',
            'Line Item Discount',
            'Sales',
            'USD',
            'L1_Operational',
            'SO_DISCOUNT',
            null,
            'Discount amount per line item.',
            'Discount <= 12% of line item gross',
            'ALERT if: Product discount > 20%',
            'Analyze by product for over-discounting.',
            'SO_DISCOUNT, SOL_PROFIT',
            'David Williams',
            'david.williams@adventureworks.com'
        ),
        (
            'SOL_UNIT_PRICE',
            'Unit Price',
            'Sales',
            'USD',
            'L1_Operational',
            'SOL_REVENUE',
            null,
            'Selling price per unit.',
            'Maintain >= 95% of list price avg',
            'ALERT if: Avg selling price < 90% of list price',
            'Monitor price erosion.',
            'SOL_PROFIT_MARGIN, INV_VALUE',
            'David Williams',
            'david.williams@adventureworks.com'
        ),
        
        -- ============================================
        -- INVENTORY METRICS (INV_*) - L2_Process
        -- ============================================
        (
            'INV_QUANTITY',
            'Inventory Quantity',
            'Inventory',
            'Count',
            'L2_Process',
            'INVENTORY_TURNOVER',
            null,
            'Current stock quantity per product/location.',
            'Between safety stock and 2x reorder point',
            'ALERT if: Quantity <= 0 (stockout)',
            'Below reorder point: Trigger purchase order.',
            'SOL_QUANTITY, INV_REORDER_PCT, PO_QUANTITY',
            'Robert Taylor',
            'robert.taylor@adventureworks.com'
        ),
        (
            'INV_VALUE',
            'Inventory Value',
            'Inventory',
            'USD',
            'L2_Process',
            'WORKING_CAPITAL',
            null,
            'Total inventory value (quantity × standard cost).',
            'Inventory turnover >= 6x annually',
            'ALERT if: Inventory value increases > 20% without sales increase',
            'High values may indicate slow-moving inventory.',
            'INV_QUANTITY, WO_ACTUAL_COST',
            'Robert Taylor',
            'robert.taylor@adventureworks.com'
        ),
        (
            'INV_ABOVE_SAFETY',
            'Quantity Above Safety Stock',
            'Inventory',
            'Count',
            'L1_Operational',
            'INV_QUANTITY',
            null,
            'Units above safety stock level.',
            'Positive value (above safety stock)',
            'ALERT if: Value <= 0',
            'Negative values require immediate replenishment.',
            'INV_QUANTITY, INV_REORDER_PCT',
            'Robert Taylor',
            'robert.taylor@adventureworks.com'
        ),
        (
            'INV_REORDER_PCT',
            'Reorder Point Percentage',
            'Inventory',
            'Percent',
            'L1_Operational',
            'INV_QUANTITY',
            null,
            'Current stock as percentage of reorder point.',
            'Between 100% and 200%',
            'ALERT if: < 100% (needs reorder)',
            'Below 100%: Create purchase order.',
            'INV_QUANTITY, PO_QUANTITY',
            'Robert Taylor',
            'robert.taylor@adventureworks.com'
        ),
        
        -- ============================================
        -- PURCHASE ORDER METRICS (PO_*) - L2_Process
        -- ============================================
        (
            'PO_AMOUNT',
            'Purchase Order Amount',
            'Procurement',
            'USD',
            'L2_Process',
            'COGS',
            'PO_SUBTOTAL',
            'Total purchase order value including tax and freight.',
            'Within budget ±5%',
            'ALERT if: Monthly spend > 110% of budget',
            'Track against budget.',
            'PO_QUANTITY, INV_VALUE',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_SUBTOTAL',
            'Purchase Order Subtotal',
            'Procurement',
            'USD',
            'L1_Operational',
            'PO_AMOUNT',
            null,
            'Purchase order subtotal before tax and freight.',
            'Achieve 3-5% YoY cost reduction',
            'ALERT if: Unit cost increases > 10%',
            'Compare across vendors.',
            'PO_AMOUNT, PO_TAX, PO_FREIGHT',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_TAX',
            'Purchase Order Tax',
            'Procurement',
            'USD',
            'L1_Operational',
            'PO_AMOUNT',
            null,
            'Tax amount on purchase orders.',
            'Proper tax treatment per jurisdiction',
            'ALERT if: Tax rate anomaly detected',
            'Ensure proper tax treatment.',
            'PO_AMOUNT, PO_SUBTOTAL',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_FREIGHT',
            'Purchase Order Freight',
            'Procurement',
            'USD',
            'L1_Operational',
            'PO_AMOUNT',
            null,
            'Inbound freight costs.',
            'Freight <= 3% of PO subtotal',
            'ALERT if: Freight > 5% of subtotal',
            'Negotiate freight terms with vendors.',
            'PO_AMOUNT, PO_DAYS_TO_SHIP',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_QUANTITY',
            'Purchase Order Quantity',
            'Procurement',
            'Count',
            'L2_Process',
            'INV_QUANTITY',
            null,
            'Total quantity ordered from vendors.',
            'Match demand forecast ±15%',
            'ALERT if: Order quantity variance > 30%',
            'Align with demand forecasts.',
            'INV_QUANTITY, PO_RECEIVED_QTY',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_RECEIVED_QTY',
            'Received Quantity',
            'Procurement',
            'Count',
            'L1_Operational',
            'PO_QUANTITY',
            null,
            'Quantity actually received from vendors.',
            '>= 98% of ordered quantity',
            'ALERT if: Received < 95% of ordered',
            'Variances indicate vendor reliability issues.',
            'PO_QUANTITY, PO_FULFILLMENT_RATE',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_REJECTED_QTY',
            'Rejected Quantity',
            'Procurement',
            'Count',
            'L1_Operational',
            'PO_REJECTION_RATE',
            null,
            'Quantity rejected due to quality issues.',
            '< 2% of received quantity',
            'ALERT if: Rejection > 5%',
            'High rejection: Review vendor quality.',
            'PO_REJECTION_RATE, PO_RECEIVED_QTY',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_REJECTION_RATE',
            'Rejection Rate',
            'Procurement',
            'Percent',
            'L2_Process',
            'SUPPLIER_QUALITY',
            'PO_REJECTED_QTY',
            'Percentage of received items rejected.',
            '< 2%',
            'ALERT if: Rate > 5%',
            'Above 5%: Escalate to vendor.',
            'PO_REJECTED_QTY, WO_SCRAP_RATE',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_FULFILLMENT_RATE',
            'Fulfillment Rate',
            'Procurement',
            'Percent',
            'L2_Process',
            'SUPPLIER_RELIABILITY',
            null,
            'Percentage of ordered quantity received.',
            '>= 98%',
            'ALERT if: Rate < 95%',
            'Below 95%: Review vendor performance.',
            'PO_RECEIVED_QTY, PO_QUANTITY',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        (
            'PO_DAYS_TO_SHIP',
            'Purchase Days to Ship',
            'Procurement',
            'Days',
            'L2_Process',
            'SUPPLIER_RELIABILITY',
            null,
            'Vendor lead time from order to shipment.',
            'Within agreed lead time ±2 days',
            'ALERT if: Lead time > agreed + 5 days',
            'Long lead times: Increase safety stock.',
            'SO_DAYS_TO_SHIP, INV_QUANTITY',
            'Jennifer Brown',
            'jennifer.brown@adventureworks.com'
        ),
        
        -- ============================================
        -- WORK ORDER METRICS (WO_*) - L1/L2
        -- ============================================
        (
            'WO_ORDER_QTY',
            'Work Order Quantity',
            'Production',
            'Count',
            'L2_Process',
            'PRODUCTION_OUTPUT',
            'WO_GOOD_QTY',
            'Quantity to be produced in work order.',
            'Align with demand forecast',
            'ALERT if: Backlog > 2 weeks of demand',
            'Align with sales forecasts.',
            'WO_GOOD_QTY, INV_QUANTITY',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_GOOD_QTY',
            'Good Quantity Produced',
            'Production',
            'Count',
            'L1_Operational',
            'WO_ORDER_QTY',
            null,
            'Quantity of acceptable products produced.',
            '>= 95% of order quantity',
            'ALERT if: Good qty < 90% of order qty',
            'Compare with order qty.',
            'WO_ORDER_QTY, WO_SCRAPPED_QTY',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_SCRAPPED_QTY',
            'Scrapped Quantity',
            'Production',
            'Count',
            'L1_Operational',
            'WO_SCRAP_RATE',
            null,
            'Quantity scrapped due to defects.',
            '< 5% of order quantity',
            'ALERT if: Scrap > 10%',
            'Analyze by scrap reason.',
            'WO_SCRAP_RATE, WO_GOOD_QTY',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_SCRAP_RATE',
            'Scrap Rate',
            'Production',
            'Percent',
            'L2_Process',
            'PRODUCTION_QUALITY',
            'WO_SCRAPPED_QTY',
            'Percentage of production scrapped.',
            '< 3%',
            'ALERT if: Rate > 5%',
            'Above 5%: Review process controls.',
            'WO_SCRAPPED_QTY, PO_REJECTION_RATE',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_PLANNED_COST',
            'Planned Cost',
            'Production',
            'USD',
            'L1_Operational',
            'WO_COST_VARIANCE',
            null,
            'Budgeted/standard cost for work order.',
            'Accurate within 5% of actual',
            'ALERT if: Planned vs actual variance > 15%',
            'Use for job costing.',
            'WO_ACTUAL_COST, WO_COST_VARIANCE',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_ACTUAL_COST',
            'Actual Cost',
            'Production',
            'USD',
            'L1_Operational',
            'WO_COST_VARIANCE',
            null,
            'Actual production cost incurred.',
            '<= 105% of planned cost',
            'ALERT if: Actual > 115% of planned',
            'Compare with planned cost.',
            'WO_PLANNED_COST, WO_COST_VARIANCE',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_COST_VARIANCE',
            'Cost Variance',
            'Production',
            'USD',
            'L2_Process',
            'PRODUCTION_EFFICIENCY',
            'WO_PLANNED_COST, WO_ACTUAL_COST',
            'Difference between actual and planned cost.',
            '<= 5% of planned cost',
            'ALERT if: Variance > 10%',
            'Positive variance: Investigate causes.',
            'WO_ACTUAL_COST, WO_PLANNED_COST',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_COST_VARIANCE_PCT',
            'Cost Variance Percent',
            'Production',
            'Percent',
            'L2_Process',
            'PRODUCTION_EFFICIENCY',
            null,
            'Cost variance as percentage of planned.',
            '<= 5%',
            'ALERT if: > 10%',
            'Above 10%: Management attention required.',
            'WO_COST_VARIANCE',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_PRODUCTION_DAYS',
            'Production Days',
            'Production',
            'Days',
            'L2_Process',
            'PRODUCTION_EFFICIENCY',
            null,
            'Days to complete production.',
            'Within standard cycle time ±10%',
            'ALERT if: Cycle time > 150% of standard',
            'Long cycle times: Review bottlenecks.',
            'WO_ACTUAL_HOURS, SO_DAYS_TO_SHIP',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_ACTUAL_HOURS',
            'Actual Production Hours',
            'Production',
            'Hours',
            'L1_Operational',
            'WO_HOURS_PER_UNIT',
            null,
            'Total labor hours for work order.',
            'Within standard hours ±15%',
            'ALERT if: Overtime > 20%',
            'Compare with standard hours.',
            'WO_HOURS_PER_UNIT, WO_PRODUCTION_DAYS',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        (
            'WO_HOURS_PER_UNIT',
            'Hours per Unit',
            'Production',
            'Hours',
            'L2_Process',
            'LABOR_PRODUCTIVITY',
            'WO_ACTUAL_HOURS',
            'Labor hours per unit produced.',
            '<= standard hours per unit',
            'ALERT if: Hours/unit > 120% of standard',
            'Increasing trend: Review process.',
            'WO_ACTUAL_HOURS, WO_GOOD_QTY',
            'James Anderson',
            'james.anderson@adventureworks.com'
        ),
        
        -- ============================================
        -- EMPLOYEE QUOTA METRICS (EQ_*) - L2/L3
        -- ============================================
        (
            'EQ_QUOTA',
            'Sales Quota',
            'HR',
            'USD',
            'L3_Tactical',
            'REVENUE_TARGET',
            null,
            'Sales target assigned to salesperson.',
            '80-120% achievement rate across team',
            'ALERT if: < 50% of team on track',
            'Review quota setting methodology.',
            'EQ_SALES_YTD, EQ_ACHIEVEMENT_PCT',
            'Amanda White',
            'amanda.white@adventureworks.com'
        ),
        (
            'EQ_SALES_YTD',
            'Sales Year to Date',
            'HR',
            'USD',
            'L2_Process',
            'EQ_ACHIEVEMENT_PCT',
            null,
            'Cumulative sales achieved year-to-date.',
            'On pace for 100% quota achievement',
            'ALERT if: YTD < 80% of prorated quota',
            'Below pace: Provide coaching.',
            'EQ_QUOTA, SO_REVENUE',
            'Amanda White',
            'amanda.white@adventureworks.com'
        ),
        (
            'EQ_SALES_LAST_YEAR',
            'Sales Last Year',
            'HR',
            'USD',
            'L2_Process',
            'YOY_GROWTH',
            null,
            'Sales achieved in prior year.',
            'YoY growth >= 5%',
            'ALERT if: Current YTD < last year by > 10%',
            'Use for trend analysis.',
            'EQ_SALES_YTD, EQ_QUOTA',
            'Amanda White',
            'amanda.white@adventureworks.com'
        ),
        (
            'EQ_ACHIEVEMENT_PCT',
            'Quota Achievement Percent',
            'HR',
            'Percent',
            'L3_Tactical',
            'SALES_PERFORMANCE',
            'EQ_SALES_YTD, EQ_QUOTA',
            'Percentage of quota achieved.',
            '>= 100%',
            'ALERT if: < 70%',
            'Below 80%: Performance improvement plan.',
            'EQ_QUOTA, EQ_SALES_YTD',
            'Amanda White',
            'amanda.white@adventureworks.com'
        ),
        (
            'EQ_QUOTA_VARIANCE',
            'Quota Variance',
            'HR',
            'USD',
            'L2_Process',
            'EQ_ACHIEVEMENT_PCT',
            null,
            'Dollar variance from quota.',
            'Positive (exceeded quota)',
            'ALERT if: Negative variance > 20%',
            'Large negative: Coaching needed.',
            'EQ_ACHIEVEMENT_PCT',
            'Amanda White',
            'amanda.white@adventureworks.com'
        ),
        (
            'EQ_BONUS',
            'Employee Bonus',
            'HR',
            'USD',
            'L2_Process',
            'EMPLOYEE_COMPENSATION',
            null,
            'Bonus amount for salesperson.',
            'Aligned with achievement level',
            'ALERT if: Bonus paid without achievement',
            'Review bonus structure.',
            'EQ_ACHIEVEMENT_PCT, EQ_QUOTA_VARIANCE',
            'Amanda White',
            'amanda.white@adventureworks.com'
        ),
        
        -- ============================================
        -- STRATEGIC / KPI METRICS (L4/L5) - Future parent metrics
        -- These are placeholders for the metrics tree hierarchy
        -- ============================================
        (
            'TOTAL_REVENUE',
            'Total Revenue',
            'Financial',
            'USD',
            'L4_Strategic',
            'NET_INCOME',
            'SO_REVENUE',
            'Total company revenue from all sources. Top-line growth indicator.',
            'YoY growth >= 10%',
            'ALERT if: QoQ decline > 5%',
            'Review by segment and territory.',
            'SO_REVENUE, GROSS_PROFIT',
            'CFO Office',
            'cfo@adventureworks.com'
        ),
        (
            'GROSS_PROFIT',
            'Gross Profit',
            'Financial',
            'USD',
            'L4_Strategic',
            'NET_INCOME',
            'SOL_PROFIT',
            'Revenue minus cost of goods sold. Measures core profitability.',
            'Gross margin >= 30%',
            'ALERT if: Gross margin < 25%',
            'Review pricing and COGS.',
            'TOTAL_REVENUE, COGS',
            'CFO Office',
            'cfo@adventureworks.com'
        ),
        (
            'GROSS_MARGIN',
            'Gross Margin',
            'Financial',
            'Percent',
            'L5_KPI',
            null,
            'GROSS_PROFIT, TOTAL_REVENUE',
            'Gross profit as percentage of revenue. Key profitability KPI.',
            '>= 35%',
            'ALERT if: < 30% OR declining 3 consecutive quarters',
            'Industry benchmark comparison required.',
            'GROSS_PROFIT, TOTAL_REVENUE, SOL_PROFIT_MARGIN',
            'CEO Office',
            'ceo@adventureworks.com'
        ),
        (
            'INVENTORY_TURNOVER',
            'Inventory Turnover',
            'Operations',
            'Count',
            'L4_Strategic',
            'WORKING_CAPITAL',
            'INV_QUANTITY, INV_VALUE',
            'How many times inventory is sold and replaced per year.',
            '>= 6x annually',
            'ALERT if: < 4x OR declining trend',
            'Low turnover: Review slow-moving inventory.',
            'INV_VALUE, COGS',
            'COO Office',
            'coo@adventureworks.com'
        ),
        (
            'CUSTOMER_SATISFACTION',
            'Customer Satisfaction',
            'Customer',
            'Count',
            'L5_KPI',
            null,
            'SO_DAYS_TO_SHIP, PO_FULFILLMENT_RATE',
            'Overall customer satisfaction score. Combines delivery and quality metrics.',
            'NPS >= 50',
            'ALERT if: NPS < 30 OR declining',
            'Survey customers, review complaints.',
            'SO_DAYS_TO_SHIP, PO_FULFILLMENT_RATE',
            'CEO Office',
            'ceo@adventureworks.com'
        ),
        (
            'PRODUCTION_EFFICIENCY',
            'Production Efficiency',
            'Operations',
            'Percent',
            'L4_Strategic',
            'OPERATING_MARGIN',
            'WO_COST_VARIANCE, WO_HOURS_PER_UNIT',
            'Overall production efficiency combining cost and time metrics.',
            'OEE >= 85%',
            'ALERT if: OEE < 75%',
            'Review bottlenecks and equipment.',
            'WO_COST_VARIANCE, WO_PRODUCTION_DAYS',
            'COO Office',
            'coo@adventureworks.com'
        ),
        (
            'SUPPLIER_QUALITY',
            'Supplier Quality',
            'Operations',
            'Percent',
            'L3_Tactical',
            'PRODUCTION_QUALITY',
            'PO_REJECTION_RATE',
            'Supplier quality index based on rejection rates.',
            'Rejection rate < 2%',
            'ALERT if: Any supplier > 5%',
            'Review vendor scorecard.',
            'PO_REJECTION_RATE, WO_SCRAP_RATE',
            'COO Office',
            'coo@adventureworks.com'
        ),
        (
            'SUPPLIER_RELIABILITY',
            'Supplier Reliability',
            'Operations',
            'Percent',
            'L3_Tactical',
            'SUPPLY_CHAIN_PERFORMANCE',
            'PO_FULFILLMENT_RATE, PO_DAYS_TO_SHIP',
            'Supplier reliability combining fulfillment and lead time.',
            'On-time delivery >= 95%',
            'ALERT if: On-time < 90%',
            'Review vendor performance.',
            'PO_FULFILLMENT_RATE, PO_DAYS_TO_SHIP',
            'COO Office',
            'coo@adventureworks.com'
        ),
        (
            'SALES_PERFORMANCE',
            'Sales Performance',
            'Sales',
            'Percent',
            'L4_Strategic',
            'TOTAL_REVENUE',
            'EQ_ACHIEVEMENT_PCT',
            'Overall sales team performance vs targets.',
            '>= 90% of team at quota',
            'ALERT if: < 70% of team at quota',
            'Review territory allocation and coaching.',
            'EQ_ACHIEVEMENT_PCT, SO_REVENUE',
            'VP Sales',
            'vp.sales@adventureworks.com'
        )
        
    ) as t(
        metric_key,
        metric_name,
        metric_category,
        metric_unit,
        metric_level,
        metric_parent,
        metric_children,
        metric_description,
        metric_target,
        alert_criteria,
        recommended_actions,
        reference_metrics,
        owner_name,
        owner_email
    )
)

select
    row_number() over (order by 
        case metric_level 
            when 'L5_KPI' then 1 
            when 'L4_Strategic' then 2 
            when 'L3_Tactical' then 3 
            when 'L2_Process' then 4 
            when 'L1_Operational' then 5 
        end,
        metric_category, 
        metric_key
    ) as metric_id,
    metric_key,
    metric_name,
    metric_category,
    metric_unit,
    metric_level,
    metric_parent,
    metric_children,
    metric_description,
    metric_target,
    alert_criteria,
    recommended_actions,
    reference_metrics,
    owner_name,
    owner_email,
    current_timestamp as created_at,
    current_timestamp as updated_at
from metrics_catalog
